{
  "version": 3,
  "sources": ["../shared/mode.ts", "../shared/runtime.ts", "../src/background.ts"],
  "sourcesContent": ["export type OutputMode = \"xpath\" | \"css\";\n\nexport const STORAGE_KEY = \"selector_output_mode\";\n\nexport async function getMode(): Promise<OutputMode> {\n  const res = await chrome.storage.sync.get(STORAGE_KEY);\n  return (res[STORAGE_KEY] as OutputMode) || \"xpath\";\n}\n\nexport async function setMode(mode: OutputMode): Promise<void> {\n  await chrome.storage.sync.set({ [STORAGE_KEY]: mode });\n}\n", "const RESTRICTED_PROTOCOL_PREFIXES = [\n  \"chrome://\",\n  \"chrome-extension://\",\n  \"edge://\",\n  \"about:\",\n  \"view-source:\",\n  \"devtools://\"\n] as const;\n\nfunction isRestrictedUrl(url: string | undefined): boolean {\n  if (!url) return true;\n  if (RESTRICTED_PROTOCOL_PREFIXES.some(prefix => url.startsWith(prefix))) return true;\n  return url.startsWith(\"https://chromewebstore.google.com/\");\n}\n\ntype TabMessageResult<T> =\n  | { delivered: true; response: T | undefined }\n  | { delivered: false };\n\nfunction sendMessageToTab<T>(tabId: number, message: unknown): Promise<TabMessageResult<T>> {\n  return new Promise(resolve => {\n    chrome.tabs.sendMessage(tabId, message, response => {\n      const err = chrome.runtime.lastError;\n      if (err) {\n        resolve({ delivered: false });\n        return;\n      }\n      resolve({ delivered: true, response: response as T | undefined });\n    });\n  });\n}\n\nasync function pingContentScript(tabId: number): Promise<boolean> {\n  const result = await sendMessageToTab<{ ok?: boolean }>(tabId, { type: \"PING\" });\n  return result.delivered && !!result.response?.ok;\n}\n\nexport function assertInjectableTab(tab: chrome.tabs.Tab): void {\n  const url = tab.url ?? tab.pendingUrl;\n  if (!url || isRestrictedUrl(url)) {\n    throw new Error(\"This page does not allow extension scripts. Try a normal website tab.\");\n  }\n}\n\nexport async function ensureContentScript(tab: chrome.tabs.Tab): Promise<void> {\n  const tabId = tab.id;\n  if (tabId == null) throw new Error(\"Missing tab id.\");\n\n  assertInjectableTab(tab);\n\n  if (await pingContentScript(tabId)) return;\n\n  await chrome.scripting.executeScript({\n    target: { tabId },\n    files: [\"dist/content.js\"]\n  });\n\n  for (let i = 0; i < 5; i++) {\n    if (await pingContentScript(tabId)) return;\n    await new Promise(r => setTimeout(r, 75));\n  }\n\n  throw new Error(\"Content script did not respond after injection.\");\n}\n\nexport async function sendMessageWithContentScript<T>(tab: chrome.tabs.Tab, message: unknown): Promise<T> {\n  const tabId = tab.id;\n  if (tabId == null) throw new Error(\"Missing tab id.\");\n\n  await ensureContentScript(tab);\n  const result = await sendMessageToTab<T>(tabId, message);\n  if (!result.delivered) {\n    throw new Error(\"Content script was unavailable when sending the message.\");\n  }\n  return result.response as T;\n}\n", "import { getMode, type OutputMode } from \"../shared/mode\";\nimport { sendMessageWithContentScript } from \"../shared/runtime\";\n\nchrome.runtime.onInstalled.addListener(() => {\n  chrome.contextMenus.create({\n    id: \"copy-selector\",\n    title: \"Copy selector (XPath/CSS)\",\n    contexts: [\"all\"]\n  });\n});\n\nchrome.contextMenus.onClicked.addListener(async (_info, tab) => {\n  const tabId = tab?.id;\n  if (tabId == null || !tab) return;\n\n  const mode = await getMode();\n\n  try {\n    await sendMessageWithContentScript(tab, { type: \"GENERATE_FROM_LAST_RIGHT_CLICK\", mode });\n  } catch (err) {\n    console.error(\"[SelectorGen] context menu failed\", err);\n  }\n});\nexport {}; \n"],
  "mappings": ";;;AAEO,MAAM,cAAc;AAE3B,iBAAsB,UAA+B;AACnD,UAAM,MAAM,MAAM,OAAO,QAAQ,KAAK,IAAI,WAAW;AACrD,WAAQ,IAAI,WAAW,KAAoB;AAAA,EAC7C;;;ACPA,MAAM,+BAA+B;AAAA,IACnC;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAEA,WAAS,gBAAgB,KAAkC;AACzD,QAAI,CAAC,IAAK,QAAO;AACjB,QAAI,6BAA6B,KAAK,YAAU,IAAI,WAAW,MAAM,CAAC,EAAG,QAAO;AAChF,WAAO,IAAI,WAAW,oCAAoC;AAAA,EAC5D;AAMA,WAAS,iBAAoB,OAAe,SAAgD;AAC1F,WAAO,IAAI,QAAQ,aAAW;AAC5B,aAAO,KAAK,YAAY,OAAO,SAAS,cAAY;AAClD,cAAM,MAAM,OAAO,QAAQ;AAC3B,YAAI,KAAK;AACP,kBAAQ,EAAE,WAAW,MAAM,CAAC;AAC5B;AAAA,QACF;AACA,gBAAQ,EAAE,WAAW,MAAM,SAAoC,CAAC;AAAA,MAClE,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAEA,iBAAe,kBAAkB,OAAiC;AAChE,UAAM,SAAS,MAAM,iBAAmC,OAAO,EAAE,MAAM,OAAO,CAAC;AAC/E,WAAO,OAAO,aAAa,CAAC,CAAC,OAAO,UAAU;AAAA,EAChD;AAEO,WAAS,oBAAoB,KAA4B;AAC9D,UAAM,MAAM,IAAI,OAAO,IAAI;AAC3B,QAAI,CAAC,OAAO,gBAAgB,GAAG,GAAG;AAChC,YAAM,IAAI,MAAM,uEAAuE;AAAA,IACzF;AAAA,EACF;AAEA,iBAAsB,oBAAoB,KAAqC;AAC7E,UAAM,QAAQ,IAAI;AAClB,QAAI,SAAS,KAAM,OAAM,IAAI,MAAM,iBAAiB;AAEpD,wBAAoB,GAAG;AAEvB,QAAI,MAAM,kBAAkB,KAAK,EAAG;AAEpC,UAAM,OAAO,UAAU,cAAc;AAAA,MACnC,QAAQ,EAAE,MAAM;AAAA,MAChB,OAAO,CAAC,iBAAiB;AAAA,IAC3B,CAAC;AAED,aAAS,IAAI,GAAG,IAAI,GAAG,KAAK;AAC1B,UAAI,MAAM,kBAAkB,KAAK,EAAG;AACpC,YAAM,IAAI,QAAQ,OAAK,WAAW,GAAG,EAAE,CAAC;AAAA,IAC1C;AAEA,UAAM,IAAI,MAAM,iDAAiD;AAAA,EACnE;AAEA,iBAAsB,6BAAgC,KAAsB,SAA8B;AACxG,UAAM,QAAQ,IAAI;AAClB,QAAI,SAAS,KAAM,OAAM,IAAI,MAAM,iBAAiB;AAEpD,UAAM,oBAAoB,GAAG;AAC7B,UAAM,SAAS,MAAM,iBAAoB,OAAO,OAAO;AACvD,QAAI,CAAC,OAAO,WAAW;AACrB,YAAM,IAAI,MAAM,0DAA0D;AAAA,IAC5E;AACA,WAAO,OAAO;AAAA,EAChB;;;ACxEA,SAAO,QAAQ,YAAY,YAAY,MAAM;AAC3C,WAAO,aAAa,OAAO;AAAA,MACzB,IAAI;AAAA,MACJ,OAAO;AAAA,MACP,UAAU,CAAC,KAAK;AAAA,IAClB,CAAC;AAAA,EACH,CAAC;AAED,SAAO,aAAa,UAAU,YAAY,OAAO,OAAO,QAAQ;AAC9D,UAAM,QAAQ,KAAK;AACnB,QAAI,SAAS,QAAQ,CAAC,IAAK;AAE3B,UAAM,OAAO,MAAM,QAAQ;AAE3B,QAAI;AACF,YAAM,6BAA6B,KAAK,EAAE,MAAM,kCAAkC,KAAK,CAAC;AAAA,IAC1F,SAAS,KAAK;AACZ,cAAQ,MAAM,qCAAqC,GAAG;AAAA,IACxD;AAAA,EACF,CAAC;",
  "names": []
}
