{
  "version": 3,
  "sources": ["../shared/mode.ts", "../shared/runtime.ts", "../src/popup.ts"],
  "sourcesContent": ["export type OutputMode = \"xpath\" | \"css\";\n\nexport const STORAGE_KEY = \"selector_output_mode\";\n\nexport async function getMode(): Promise<OutputMode> {\n  const res = await chrome.storage.sync.get(STORAGE_KEY);\n  return (res[STORAGE_KEY] as OutputMode) || \"xpath\";\n}\n\nexport async function setMode(mode: OutputMode): Promise<void> {\n  await chrome.storage.sync.set({ [STORAGE_KEY]: mode });\n}\n", "const RESTRICTED_PROTOCOL_PREFIXES = [\n  \"chrome://\",\n  \"chrome-extension://\",\n  \"edge://\",\n  \"about:\",\n  \"view-source:\",\n  \"devtools://\"\n] as const;\n\nfunction isRestrictedUrl(url: string | undefined): boolean {\n  if (!url) return true;\n  if (RESTRICTED_PROTOCOL_PREFIXES.some(prefix => url.startsWith(prefix))) return true;\n  return url.startsWith(\"https://chromewebstore.google.com/\");\n}\n\ntype TabMessageResult<T> =\n  | { delivered: true; response: T | undefined }\n  | { delivered: false };\n\nfunction sendMessageToTab<T>(tabId: number, message: unknown): Promise<TabMessageResult<T>> {\n  return new Promise(resolve => {\n    chrome.tabs.sendMessage(tabId, message, response => {\n      const err = chrome.runtime.lastError;\n      if (err) {\n        resolve({ delivered: false });\n        return;\n      }\n      resolve({ delivered: true, response: response as T | undefined });\n    });\n  });\n}\n\nasync function pingContentScript(tabId: number): Promise<boolean> {\n  const result = await sendMessageToTab<{ ok?: boolean }>(tabId, { type: \"PING\" });\n  return result.delivered && !!result.response?.ok;\n}\n\nexport function assertInjectableTab(tab: chrome.tabs.Tab): void {\n  const url = tab.url ?? tab.pendingUrl;\n  if (!url || isRestrictedUrl(url)) {\n    throw new Error(\"This page does not allow extension scripts. Try a normal website tab.\");\n  }\n}\n\nexport async function ensureContentScript(tab: chrome.tabs.Tab): Promise<void> {\n  const tabId = tab.id;\n  if (tabId == null) throw new Error(\"Missing tab id.\");\n\n  assertInjectableTab(tab);\n\n  if (await pingContentScript(tabId)) return;\n\n  await chrome.scripting.executeScript({\n    target: { tabId },\n    files: [\"dist/content.js\"]\n  });\n\n  for (let i = 0; i < 5; i++) {\n    if (await pingContentScript(tabId)) return;\n    await new Promise(r => setTimeout(r, 75));\n  }\n\n  throw new Error(\"Content script did not respond after injection.\");\n}\n\nexport async function sendMessageWithContentScript<T>(tab: chrome.tabs.Tab, message: unknown): Promise<T> {\n  const tabId = tab.id;\n  if (tabId == null) throw new Error(\"Missing tab id.\");\n\n  await ensureContentScript(tab);\n  const result = await sendMessageToTab<T>(tabId, message);\n  if (!result.delivered) {\n    throw new Error(\"Content script was unavailable when sending the message.\");\n  }\n  return result.response as T;\n}\n", "import { getMode, setMode, type OutputMode } from \"../shared/mode\";\nimport { sendMessageWithContentScript } from \"../shared/runtime\";\n\nfunction q<T extends HTMLElement>(sel: string): T {\n  const el = document.querySelector(sel);\n  if (!el) throw new Error(`Missing element: ${sel}`);\n  return el as T;\n}\n\nasync function injectAndSend(msg: unknown): Promise<void> {\n  const tabs = await chrome.tabs.query({ active: true, currentWindow: true });\n  const tab = tabs[0];\n  if (!tab) throw new Error(\"No active tab found.\");\n\n  await sendMessageWithContentScript(tab, msg);\n}\n\nasync function main(): Promise<void> {\n  const xpathRadio = q<HTMLInputElement>(\"#out-xpath\");\n  const cssRadio = q<HTMLInputElement>(\"#out-css\");\n  const pickBtn = q<HTMLButtonElement>(\"#btn-pick\");\n\n  const mode = await getMode();\n  xpathRadio.checked = mode === \"xpath\";\n  cssRadio.checked = mode === \"css\";\n\n  xpathRadio.addEventListener(\"change\", async () => {\n    if (xpathRadio.checked) await setMode(\"xpath\");\n  });\n\n  cssRadio.addEventListener(\"change\", async () => {\n    if (cssRadio.checked) await setMode(\"css\");\n  });\n\n  pickBtn.addEventListener(\"click\", async () => {\n    const currentMode = await getMode();\n    await injectAndSend({ type: \"START_PICKER\", mode: currentMode });\n    window.close();\n  });\n}\n\nmain().catch(console.error);\nexport {};\n"],
  "mappings": "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",
  "names": []
}
